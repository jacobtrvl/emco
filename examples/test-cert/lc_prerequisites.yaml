# SPDX-License-Identifier: Apache-2.0
# Copyright (c) 2022 Intel Corporation

# register rsync controller
version: emco/v2
resourceContext:
  anchor: controllers
metadata :
  name: rsync
spec:
  host:  {{.HostIP}}
  port: {{.RsyncPort}}
---
# create project
version: emco/v2
resourceContext:
  anchor: projects
metadata :
  name: {{.ProjectName}}
---
# create cluster provider
version: emco/v2
resourceContext:
  anchor: cluster-providers
metadata :
  name: {{.ClusterProvider}}
---
# create issuing cluster
version: emco/v2
resourceContext:
  anchor: cluster-providers/{{.ClusterProvider}}/clusters
metadata :
  name: {{.IssuingCluster}}
file:
  {{.IssuingClusterConfig}}
---
# create cluster 1
version: emco/v2
resourceContext:
  anchor: cluster-providers/{{.ClusterProvider}}/clusters
metadata :
  name: {{.Cluster1}}
file:
  {{.IssuingClusterConfig}}
---
# add cluster 2 label
version: emco/v2
resourceContext:
  anchor: cluster-providers/{{.ClusterProvider}}/clusters/{{.Cluster1}}/labels
clusterLabel: {{.GroupLabel1}}
---
# create cluster 2
version: emco/v2
resourceContext:
  anchor: cluster-providers/{{.ClusterProvider}}/clusters
metadata :
  name: {{.Cluster2}}
file:
  {{.IssuingClusterConfig}}
---
# add cluster 3 label
version: emco/v2
resourceContext:
  anchor: cluster-providers/{{.ClusterProvider}}/clusters/{{.Cluster2}}/labels
clusterLabel: {{.GroupLabel2}}
---
# create cluster 3
version: emco/v2
resourceContext:
  anchor: cluster-providers/{{.ClusterProvider}}/clusters
metadata :
  name: {{.Cluster3}}
file:
  {{.IssuingClusterConfig}}
---
# create cluster 4
version: emco/v2
resourceContext:
  anchor: cluster-providers/{{.ClusterProvider}}/clusters
metadata :
  name: {{.Cluster4}}
file:
  {{.IssuingClusterConfig}}
---
# add cluster 4 label
version: emco/v2
resourceContext:
  anchor: cluster-providers/{{.ClusterProvider}}/clusters/{{.Cluster4}}/labels
clusterLabel: {{.GroupLabel1}}
---
# create cluster 4
version: emco/v2
resourceContext:
  anchor: cluster-providers/{{.ClusterProvider}}/clusters
metadata :
  name: {{.Cluster5}}
file:
  {{.IssuingClusterConfig}}
---
# add cluster 3 label
version: emco/v2
resourceContext:
  anchor: cluster-providers/{{.ClusterProvider}}/clusters/{{.Cluster5}}/labels
clusterLabel: {{.GroupLabel2}}
---
# add the cert intent1
version: emco/v2
resourceContext:
  anchor: projects/{{.ProjectName}}/ca-certs
metadata:
  name: {{.CertIntent1}}
spec:
  isCA: true
  issuerRef:
    name: {{.ClusterIssuer}}
    kind: {{.Kind}}
    group: {{.Group}}
  duration: "8760h"
  issuingCluster: 
    cluster: {{.IssuingCluster}}
    clusterProvider: {{.ClusterProvider}}
  csrInfo: 
    keySize: {{.KeySize}}
    version: 1
    dnsNames: []
    emailAddresses: []
    keyUsages: []
    algorithm: 
      publicKeyAlgorithm: RSA
      signatureAlgorithm: SHA512WithRSA
    subject:
      locale: 
        country: []
        locality: []
        postalCode: []
        province: []
        streetAddress: []
      names:
        commonNamePrefix: {{.CommonNamePrefix}}
      organization:
        names: []
        units: []
---
# add the cert intent2
version: emco/v2
resourceContext:
  anchor: projects/{{.ProjectName}}/ca-certs
metadata:
  name: {{.CertIntent2}}
spec:
  isCA: true
  issuerRef:
    name: {{.ClusterIssuer}}
    kind: {{.Kind}}
    group: {{.Group}}
  duration: "8760h"
  issuingCluster: 
    cluster: {{.IssuingCluster}}
    clusterProvider: {{.ClusterProvider}}
  csrInfo: 
    keySize: {{.KeySize}}
    version: 1
    dnsNames: []
    emailAddresses: []
    keyUsages: []
    algorithm: 
      publicKeyAlgorithm: RSA
      signatureAlgorithm: SHA512WithRSA
    subject:
      locale: 
        country: []
        locality: []
        postalCode: []
        province: []
        streetAddress: []
      names:
        commonNamePrefix: {{.CommonNamePrefix}}
      organization:
        names: []
        units: []
---
# add the cert intent3
version: emco/v2
resourceContext:
  anchor: projects/{{.ProjectName}}/ca-certs
metadata:
  name: {{.CertIntent3}}
spec:
  isCA: true
  issuerRef:
    name: {{.ClusterIssuer}}
    kind: {{.Kind}}
    group: {{.Group}}
  duration: "8760h"
  issuingCluster: 
    cluster: {{.IssuingCluster}}
    clusterProvider: {{.ClusterProvider}}
  csrInfo: 
    keySize: {{.KeySize}}
    version: 1
    dnsNames: []
    emailAddresses: []
    keyUsages: []
    algorithm: 
      publicKeyAlgorithm: RSA
      signatureAlgorithm: SHA512WithRSA
    subject:
      locale: 
        country: []
        locality: []
        postalCode: []
        province: []
        streetAddress: []
      names:
        commonNamePrefix: {{.CommonNamePrefix}}
      organization:
        names: []
        units: []
---
# add logical cloud part of the cert intent1
version: emco/v2
resourceContext:
  anchor: projects/{{.ProjectName}}/ca-certs/{{.CertIntent3}}/logical-clouds
metadata :
  name: {{.AdminCloud}}
spec:
  name: {{.AdminCloud}}
---
# add logical cloud part of the cert intent2
version: emco/v2
resourceContext:
  anchor: projects/{{.ProjectName}}/ca-certs/{{.CertIntent1}}/logical-clouds
metadata :
  name: {{.FooLogicalCloud}}
spec:
  name: {{.FooLogicalCloud}}
---
# add logical cloud part of the cert intent3
version: emco/v2
resourceContext:
  anchor: projects/{{.ProjectName}}/ca-certs/{{.CertIntent2}}/logical-clouds
metadata :
  name: {{.BarLogicalCloud}}
spec:
  name: {{.BarLogicalCloud}}
---
# add the cluster part of the cert intent
version: emco/v2
resourceContext:
  anchor: projects/{{.ProjectName}}/ca-certs/{{.CertIntent3}}/logical-clouds/{{.AdminCloud}}/clusters
metadata :
  name: {{.EdgeClusters}}
spec:
  scope: name
  label: {{.ClusterLabel}}
  name: {{.Cluster3}}
  clusterProvider: {{.ClusterProvider}}
---
# add the cluster part of the cert intent
version: emco/v2
resourceContext:
  anchor: projects/{{.ProjectName}}/ca-certs/{{.CertIntent1}}/logical-clouds/{{.FooLogicalCloud}}/clusters
metadata :
  name: {{.EdgeClusters1}}
spec:
  scope: label
  label: {{.GroupLabel1}}
  name: {{.Cluster1}}
  clusterProvider: {{.ClusterProvider}}
---
# add the cluster part of the cert intent
version: emco/v2
resourceContext:
  anchor: projects/{{.ProjectName}}/ca-certs/{{.CertIntent2}}/logical-clouds/{{.BarLogicalCloud}}/clusters
metadata :
  name: {{.EdgeClusters2}}
spec:
  scope: label
  label: {{.GroupLabel2}}
  name: {{.Cluster2}}
  clusterProvider: {{.ClusterProvider}}
